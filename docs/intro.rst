.. _user:

*********
Swak 소개
*********

이 페이지에서는 Swak 사용을 위한 기본적인 내용을 설명한다. 더 자세한 내용은 아래 링크를 참고한다.

:ref:`rst_index` 를 살펴보자.

무엇인가?
=========

* 멀티 OS(Windows, Linux, macOS)에서
* 서비스(데몬) 형태로
* 다양한 목적을 위한 파이썬 플러그인을 실행하거나
* 외부 프로세스를 실행해주는 틀

코드 설치
=========

여기서는 배포 용이 아닌 개발 및 빌드를 위해 코드로 받아 설치하는 것을 설명하겠다.

.. note:: 윈도우에서 설치를 위해서는 먼저 `윈도우 용 git 클라이언트 <https://git-scm.com/download/win>`_ 를 받아서 설치하자.

.. code-block:: sh

    git clone https://github.com/haje01/swak.git
    cd swak
    pip install -r requirements.txt
    pip intall .


플러그인 구조
=============

Swak은 어플리케이션의 기본 틀외 모든 기능들을 플러그인으로 구현한다. 플러그인은 크게 입력, 파서, 교정, 버퍼, 출력 그리고 명령 플러그인의 여섯가지 타입으로 나뉜다. 각 타입별 플러그인은 다음과 같은 패키지명 형식으로 시작한다.

* 입력 플러그인 ``in.``
* 파서 플러그인 ``par.``
* 교정 플러그인 ``ref.``
* 버퍼 플러그인 ``buf.``
* 출력 플러그인 ``out.``
* 명령 플러그인 ``cmd.``

다음과 같은 기본 플러그인들을 가진다.

* ``in.filetail``  파일에 추가된 행을 가져옴
* ``buf.file`` - 데이터를 파일에 버퍼링함
* ``out.fluentd`` - Fluentd로 출력

자세한 것은 :doc:`plugins` 를 참고하자.


코드 디렉토리 구조
------------------

기본적인 코드 디렉토리 구조는 다음과 같다::

    swak/
      swak/        # 코드 디렉토리
      tests/       # 테스트 코드 디렉토리
      plugins/     # 플러그인 디렉토리

      devhome/     # 개발용 홈 디렉토리
        config.yml # 개발용 설정 파일
        logs/      # 로그 디렉토리
        run/       # 데몬으로 실행된 경우 .pid 파일 저장


홈 디렉토리
===========

Swak은 실행을 위해 홈 디렉토리를 필요로 한다. 이것은 다음과 같은 구조를 가진다::

    SWAK_HOME/
      config.yml  # 설정 파일
      logs/       # 설정 파일에 따라 실행한 로그가 저장
      run/        # 데몬으로 띄워진 경우 .pid 파일이 저장

사용할 홈 디렉토리는 다음과 같은 순서로 결정된다.

1. 스크립트나 실행 파일 인자로 홈 디렉토리 경로를 받은 경우 그것을 이용.
2. ``SWAK_HOME`` 환경 변수가 설정되어 있으면 그것을 이용.
3. 스크립트나 실행 파일과 같은 디렉토리에 ``config.yml`` 이 있으면 그곳을 홈 디렉토리로 이용.
4. 여기까지 없으면 에러 발생.

필요에 맞게 다음과 같은 식으로 홈 디렉토리를 지정한다.

- 개발을 위해 소스를 받은 경우는 소스 디렉토리 내의  ``devhome`` 의 절대 경로를 스크립트 파일의 인자, 또는 환경 변수로 지정한다. 그러면 그 안의 개발용 ``config.yml`` 파일을 참고하여 실행된다.
- 본인 만의 커스텀한 설정이 필요한 경우, ``devhome/config.yml`` 을 수정하지 말고, 별도로 디렉토리를 만들고 거기에 ``config.yml`` 을 만들고, 홈 디렉토리로 사용한다. (``logs/``, ``run/`` 같은 하위 디렉토리는 자동으로 만들어진다.)
- 바이너리로 빌드되어 배포 될 때는, 일반적으로 실행 파일과 같은 디렉토리에 ``config.yml`` 을 만들어 주면 된다.

.. note:: 개발용 홈 디렉토리 ``devhome`` 은 Swak 개발 시 테스트를 위해 사용하는 홈 디렉토리이다.
